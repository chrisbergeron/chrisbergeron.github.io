<!doctype html>
<html lang="en"><head><meta charset="utf-8"><link rel="bookmark" type="image/x-icon" href="/images/icons/logo-apple-icon.png"><link rel="shortcut icon" href="/images/icons/logo-apple-icon.png"><link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/images/icons/favicon.ico"><link rel="apple-touch-icon" type="image/png" sizes="16x16" href="/images/icons/apple-touch-icon-16.png"><link rel="apple-touch-icon" type="image/png" sizes="29x29" href="/images/icons/apple-touch-icon-29.png"><link rel="apple-touch-icon" type="image/png" sizes="32x32" href="/images/icons/apple-touch-icon-32.png"><link rel="apple-touch-icon" type="image/png" sizes="40x40" href="/images/icons/apple-touch-icon-40.png"><link rel="apple-touch-icon" type="image/png" sizes="50x50" href="/images/icons/apple-touch-icon-50.png"><link rel="apple-touch-icon" type="image/png" sizes="57x57" href="/images/icons/apple-touch-icon-57.png"><link rel="apple-touch-icon" type="image/png" sizes="58x58" href="/images/icons/apple-touch-icon-58.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="/images/icons/apple-touch-icon-60.png"><link rel="apple-touch-icon" type="image/png" sizes="64x64" href="/images/icons/apple-touch-icon-64.png"><link rel="apple-touch-icon" type="image/png" sizes="72x72" href="/images/icons/apple-touch-icon-72.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="/images/icons/apple-touch-icon-76.png"><link rel="apple-touch-icon" type="image/png" sizes="80x80" href="/images/icons/apple-touch-icon-80.png"><link rel="apple-touch-icon" type="image/png" sizes="87x87" href="/images/icons/apple-touch-icon-87.png"><link rel="apple-touch-icon" type="image/png" sizes="100x100" href="/images/icons/apple-touch-icon-100.png"><link rel="apple-touch-icon" type="image/png" sizes="114x114" href="/images/icons/apple-touch-icon-114.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="/images/icons/apple-touch-icon-120.png"><link rel="apple-touch-icon" type="image/png" sizes="128x128" href="/images/icons/apple-touch-icon-128.png"><link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/images/icons/apple-touch-icon-144.png"><link rel="apple-touch-icon" type="image/png" sizes="152x152" href="/images/icons/apple-touch-icon-152.png"><link rel="apple-touch-icon" type="image/png" sizes="167x167" href="/images/icons/apple-touch-icon-167.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/images/icons/apple-touch-icon-180.png"><link rel="apple-touch-icon" type="image/png" sizes="256x256" href="/images/icons/apple-touch-icon-256.png"><link rel="apple-touch-icon" type="image/png" sizes="512x512" href="/images/icons/apple-touch-icon-512.png"><link rel="apple-touch-icon" type="image/png" sizes="1024x1024" href="/images/icons/apple-touch-icon-1024.png"><link rel="icon" type="image/png" href="/images/icons/apple-touch-icon-114.png"><meta name="description" content="An online technology journal with how-to articles, projects and examples."><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta><script src="/mc.js"></script><title>Ultra fast Thunderbolt NAS with Apple M1 and Linux - Chris Bergerons Tech Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Chris Bergerons Tech Blog"><meta name="msapplication-TileImage" content="/images/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Chris Bergerons Tech Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="In this post I discuss how you can upgrade a NAS Server by adding Thunderbolt 3 for lightning fast connectivity at 20 or 40Gbps.  This particular implementation is specific to an Apple Mac Mini M1 and"><meta property="og:type" content="article"><meta property="og:title" content="Chris Bergeron Tech Blog"><meta property="og:url" content="https://chrisbergeron.com/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/"><meta property="og:site_name" content="Chris Bergerons Tech Blog"><meta property="og:description" content="In this post I discuss how you can upgrade a NAS Server by adding Thunderbolt 3 for lightning fast connectivity at 20 or 40Gbps.  This particular implementation is specific to an Apple Mac Mini M1 and"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://chrisbergeron.com/images/cb-cover.jpg"><meta property="article:published_time" content="2021-07-26T01:58:08.000Z"><meta property="article:modified_time" content="2023-04-01T02:57:04.771Z"><meta property="article:author" content="Chris Bergeron"><meta property="article:tag" content="linux"><meta property="article:tag" content="das"><meta property="article:tag" content="thunderbolt"><meta property="article:tag" content="nvme"><meta property="article:tag" content="big sur"><meta property="article:tag" content="apple"><meta property="article:tag" content="tbt3"><meta property="article:tag" content="tbt4"><meta property="article:tag" content="nas"><meta property="article:tag" content="monterey"><meta property="article:tag" content="titan ridge"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://chrisbergeron.com/images/cb-cover.jpg"><meta property="twitter:creator" content="@bergeron"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://chrisbergeron.com"},"headline":"Chris Bergeron Tech Blog","image":[],"datePublished":"2021-07-26T01:58:08.000Z","dateModified":"2023-04-01T02:57:04.771Z","author":{"@type":"Person","name":"Chris Bergeron"},"description":"In this post I discuss how you can upgrade a NAS Server by adding Thunderbolt 3 for lightning fast connectivity at 20 or 40Gbps.  This particular implementation is specific to an Apple Mac Mini M1 and"}</script><link rel="canonical" href="https://chrisbergeron.com/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/"><link rel="alternate" href="/" title="Chris Bergerons Tech Blog" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.dark.css" media="(prefers-color-scheme: dark)" id="theme-link"><link rel="stylesheet" href="/css/default.light.css" media="(prefers-color-scheme: light)" id="theme-link"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-5MJNLK80PN" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-5MJNLK80PN');</script><!--!--><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img alt="Chris Bergerons Tech Blog" no-lazy src="/images/logo.png" width="288" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="RSS Feed" href="https://chrisbergeron.com/rss2.xml"><i class="fa fa-rss fa-1x"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Contents" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-26T01:58:08.000Z" title="2021-07-26T01:58:08.000Z">07-25-2021</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-04-01T02:57:04.771Z" title="2023-04-01T02:57:04.771Z">03-31-2023</time></span><span class="level-item"><a class="link-muted" href="/categories/Homelab/">Homelab</a></span></div></div><h1 class="title is-3 is-size-4-mobile">Ultra fast Thunderbolt NAS with Apple M1 and Linux</h1><div class="content"><p>In this post I discuss how you can upgrade a NAS Server by adding Thunderbolt 3 for lightning fast connectivity at 20 or 40Gbps.  This particular implementation is specific to an Apple Mac Mini M1 and a <a href="https://chrisbergeron.com/2020/03/07/diy_das_part1/">Linux NAS server</a> on an older Supermicro X10SRL-F motherboard, but the principles should be the same on similar architectures and operating systems.</p>
<span id="more"></span>
<p>I’m running the latest (Q3 2021) linux kernel on the NAS Server:</p>
<p><code>Linux nas-04 5.13.4-1.el7.elrepo.x86_64 #1 SMP Wed Jul 21 23:02:00 EDT 2021 x86_64 x86_64 x86_64 GNU/Linux</code></p>
<p>I should note that one major caveat to this configuration is that it’s point to point between two computers via Thunderbolt 4 cable(s).  The networking functionality of the NAS hasn’t been disrupted or replaced, it’s simply augmented with another communication medium between two nearby computers.  Thunderbolt allows for bridge mode, so multiple devices can be connected in series.</p>
<h1 id="My-Motivation-s"><a href="#My-Motivation-s" class="headerlink" title="My Motivation(s)"></a>My Motivation(s)</h1><p>This implementation isn’t particularly novel.  It is however relatively new and a lot of people that might not otherwise be aware of this approach to fast storage might find it interesting.  In particular, people with smaller system disks that are non-upgradable that do Video Editing, people that shuffle VMs in their homelab, et al.  There are a lot of existing Thunderbolt Direct Attach (DAS) enclosures (OWC makes some nice ones - no affiliation), but based on my cursory research I wasn’t able to find much that delved into using Thunderbolt’s <em>networking</em> capability to connect to an existing NAS server (albeit point-to-point).  I like the idea of having a pseudo-DAS via NAS over PtP Thunderbolt.  The Thunderbolt 4 spec includes fiber, so eventually cable distance won’t be a limiting factor.</p>
<p>Because I wasn’t able to find a lot of documentation about the linux thunderbolt interfaces and there are not a lot of user-space tools presently available (Q3 2021), I decided to compile my thoughts and output captures here.</p>
<p>I’m a data hoarder and I still have various data going back a couple of decades.  My data consist of email from the late 90’s, old hard disk images, documents, source code, databases, pictures and other digital things I’ve created or collected over the years.  Much of it is in archival (old MIDI files, DOS games and similar), but occassionally I will seek something out which often requires mounting a disk image or searching a large file index.  As a result, I’m always exploring ways to improve my <a href="/categories/homelab">home computer lab</a>.  Plus, I just enjoy pushing the limits of performance.</p>
<p>After upgrading my <a href="/categories/homelab">homelab</a> network to 10Gbps (~ 1,250 MB/s) I was quite happy with the overall performance.  However, I quickly found myself upgrading the NAS with NVMe disks and even striping several of them for maximum performance.  As NVMe disks and interfaces have gotten faster I’ve found myself saturating a 10Gb ethernet network.<!--As each upgrade removes a performance bottleneck it uncovers yet another. -->  Thunderbolt is exciting for several reasons, but most notable for me is the sheer speed and bandwidth capability.</p>
<h1 id="Adding-a-Thunderbolt-3-PCIe-Add-on-Card"><a href="#Adding-a-Thunderbolt-3-PCIe-Add-on-Card" class="headerlink" title="Adding a Thunderbolt 3 PCIe Add-on Card"></a>Adding a Thunderbolt 3 PCIe Add-on Card</h1><p><a target="_blank" rel="noopener" href="https://www.amazon.com/gp/product/B08BC11XW8/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B08BC11XW8&amp;linkCode=as2&amp;tag=chrisberg-20&amp;linkId=52abc69e565e41a48143aaeb72ca41e8"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/gigabyte-gc-titan-ridge-thunderbolt-pcie-card-500-cb.png" alt="Titan Ridge Thunderbolt Card" title="Gigabyte GC Titan Ridge Thunderbolt PCIe Card"></a></p>
<!--
![Titan Ridge Thunderbolt Card](/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/gigabyte-gc-titan-ridge-thunderbolt-pcie-card-500-cb.png "Gigabyte GC Titan Ridge Thunderbolt PCIe Card")-->
<p>Adding a single 4 lane PCIe 3.0 card to an existing NAS server in a SOHO is a relatively straightforward process.  I wasn’t sure that the card I selected would work for a few reasons:</p>
<ul>
<li>I didn’t know if Thunderbolt required modern CPU architecture.  Intel is including Thunderbolt in the CPU of the forthcoming Ice Lake processors (<em>I think</em>), but for now it remains an external add-on chipset.</li>
<li>My NAS, as I suspect many other Homelabbers and hobbyists doesn’t have a state-of-the-art processor or motherboard chipset.</li>
<li>I reasonably concluded that the latest Linux Kernel and corresponding modules/code would support Thunderbolt but I wasn’t sure of the extent of compatibility and/or any “X Factors” that might arise from my specific hardware / software combination and use case.</li>
</ul>
<p>I set aside my trepidation and decided to just try it.  No guts no air medal, right?</p>
<p>There is a hardware “hack” involved with implementing this card in an older motherboard.  Fortunately, it’s an easy one and the card vendor provides almost everything needed in the box.  I haven’t delved into the software override functionality yet, so this hardware modification may not be necessary at all, YMMV.</p>
<p>What’s notable about this configuration is that the motherboard doesn’t have a Thunderbolt (tbt_3 or tbt_4) header and there are no special CPU / chipset requirements.  It’s just an Intel Xeon based motherboard/cpu combination with a Gigabyte GC 2.0 Titan Ridge PCIe Thunderbolt 3 card.</p>
<p>I used the work ‘hack’ lightly above.  To get a server without a dedicated thunderbolt header to see the PCIe card, you need to short pins 3 and 5 together like this:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/thunderbolt-titan-ridge-short-pins-3-and-5.jpg" alt="Connecting wires 3 and 5 together on tbt connector." title="Connector with wires 3 and 5 shorted."></p>
<p>In effect, this tells the card that it’s plugged in.  The THB_C port on a “Thunderbolt™ Enabled” motherboard may provide extra DisplayPort capability.  <del>I wasn’t able to find a conclusive reason for the tbt header connection aside from theories about vendor locking.  I’m sure it’s in the Intel Thunderbolt whitepaper (GPIO) but I haven’t looked it over yet.</del> More information about the TBT Motherboard header and <a href="#Thunderbolt-Header">pinout can be found below.</a></p>
<p>All I know is that if you get this card and it doesn’t appear in your device list, you may need to short these two wires. <em>I take no responsibility for anything that happens if you do this and something bad happens - please research accordingly.</em></p>
<p>Now that the card is installed and internal cables are connected it’s time to power up the NAS Server.</p>
<hr>
<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="Host-1-NAS-04-Linux"><a href="#Host-1-NAS-04-Linux" class="headerlink" title="Host 1:  NAS-04 (Linux)"></a>Host 1:  NAS-04 (Linux)</h2><p>This host is a Linux server.  It’s running on a Supermicro X10SRL-F motherboard with an Intel Xeon CPU.  The chassis’ are two Supermicro 836A.  <a href="/2020/03/07/diy_das_part1/">One chassis is the NAS server, the other is a DAS</a> (Disk shelf) attached to the NAS for a total of 32+ removable disk bays.</p>
<p>After powering up the NAS server we can see the Titan Ridge card using <code>lspci</code>:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">02:00.0 PCI bridge: Intel Corporation JHL7540 Thunderbolt 3 Bridge [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">03:00.0 PCI bridge: Intel Corporation JHL7540 Thunderbolt 3 Bridge [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">03:01.0 PCI bridge: Intel Corporation JHL7540 Thunderbolt 3 Bridge [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">03:02.0 PCI bridge: Intel Corporation JHL7540 Thunderbolt 3 Bridge [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">03:04.0 PCI bridge: Intel Corporation JHL7540 Thunderbolt 3 Bridge [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">04:00.0 System peripheral: Intel Corporation JHL7540 Thunderbolt 3 NHI [Titan Ridge 4C 2018] (rev 06)</span><br><span class="line">06:00.0 USB controller: Intel Corporation JHL7540 Thunderbolt 3 USB Controller [Titan Ridge 4C 2018] (rev 06)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>We can see more information in the <code>/sys/bus/thunderbolt</code> kernel syspath.  This is the output prior to connecting a thunderbolt cable to another host:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@nas-04:/sys/bus/thunderbolt <span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── devices</span><br><span class="line">│   ├── 0-0 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0</span><br><span class="line">│   ├── 0-3 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0/0-3</span><br><span class="line">│   └── domain0 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0</span><br><span class="line">├── drivers</span><br><span class="line">│   └── thunderbolt-net</span><br><span class="line">│       ├── <span class="built_in">bind</span></span><br><span class="line">│       ├── module -&gt; ../../../../module/thunderbolt_net</span><br><span class="line">│       ├── uevent</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>After connecting the thunderbolt cable the <code>thunderbolt0</code> device comes up as <strong>0-3.0</strong>:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@nas-04:/sys/bus/thunderbolt <span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── devices</span><br><span class="line">│   ├── 0-0 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0</span><br><span class="line">│   ├── 0-3 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0/0-3</span><br><span class="line"></span><br><span class="line">│   ├── 0-3.0 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0/0-3/0-3.0</span><br><span class="line"></span><br><span class="line">│   └── domain0 -&gt; ../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0</span><br><span class="line">├── drivers</span><br><span class="line">│   └── thunderbolt-net</span><br><span class="line">│       ├── 0-3.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0/0000:03:00.0/0000:04:00.0/domain0/0-0/0-3/0-3.0</span><br><span class="line">│       ├── <span class="built_in">bind</span></span><br><span class="line">│       ├── module -&gt; ../../../../module/thunderbolt_net</span><br><span class="line">│       ├── uevent</span><br><span class="line">│       └── unbind</span><br><span class="line">├── drivers_autoprobe</span><br><span class="line">├── drivers_probe</span><br><span class="line">└── uevent</span><br></pre></td></tr></tbody></table></figure>
<p>… and we can view the relevant kernel message buffer lines (log) with <code>dmesg</code>:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Sun Jul 25 16:24:56 2021] thunderbolt-net 0-3.0 thunderbolt0: ThunderboltIP login timed out</span><br><span class="line">[Sun Jul 25 16:50:04 2021] thunderbolt 0-3: host disconnected</span><br><span class="line">[Sun Jul 25 16:50:16 2021] thunderbolt 0-3: new host found, vendor=0xa27 device=0xa</span><br><span class="line">[Sun Jul 25 16:50:16 2021] thunderbolt 0-3: Apple Inc. Macmini9,1</span><br><span class="line">[Sun Jul 25 16:50:22 2021] IPv6: ADDRCONF(NETDEV_CHANGE): thunderbolt0: link becomes ready</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Interestingly, we can also see that the Mac Mini is immediately auto discovered and that the <code>thunderbolt0</code> network interface has become available.  I thought I would have to start the kernel module (driver) for <code>thunderbolt-net</code>, but it looks like it happened automatically.</p>
<p>You can check to see if the <code>thunderbolt</code> and <code>thunderbolt-net</code> kernel modules are loaded using <code>lsmod</code>.  If you don’t see them listed, you can manually load them with <code>modprobe thunderbolt</code> and <code>modprobe thunderbolt-net</code>.</p>
<p>After the network device becomes available we can address and configure it using standard userspace tools.  I use good old <code>ifconfig</code> to set a non-link-local (not automatic 169.254.x.x) IP address for the interface.  Using <code>ip addr</code> or other userspace tools (GUI) should work just fine.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@nas-04:~ <span class="comment"># ifconfig thunderbolt0 10.10.10.2</span></span><br><span class="line"></span><br><span class="line">root@nas-04:~ <span class="comment"># ifconfig thunderbolt0</span></span><br><span class="line">thunderbolt0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.10.10.2  netmask 255.0.0.0  broadcast 10.255.255.255</span><br><span class="line">        inet6 fe80::7b8c:bc15:a8f1:93f5  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 12:e2:e9:5f:d5:4b  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 103  bytes 55297 (54.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 31  bytes 8602 (8.4 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></tbody></table></figure>
<p>Now that the interface has an IP, we have to add a static host route entry for it to communicate:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add static host route</span></span><br><span class="line">root@nas-04:~/bolt <span class="comment"># route add -host 192.168.10.2 dev thunderbolt0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># View route table</span></span><br><span class="line">root@nas-04:~/bolt <span class="comment"># route -n</span></span><br><span class="line"></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.6.1     0.0.0.0         UG    101    0        0 eno1</span><br><span class="line">&lt;snip&gt;</span><br><span class="line">192.168.10.2    0.0.0.0         255.255.255.255 UH    0      0        0 thunderbolt0</span><br></pre></td></tr></tbody></table></figure>
<p>Next, we just need to set up the Thunderbolt routeable IP on the Mac.</p>
<hr>
<h2 id="Host-2-Apple-Mac-Mini"><a href="#Host-2-Apple-Mac-Mini" class="headerlink" title="Host 2: Apple Mac Mini"></a>Host 2: Apple Mac Mini</h2><p>The other host in this setup a Mac Mini.  Thunderbolt 4 is not a requirement for this setup and neither is Apple Silicon.  Thunderbolt is an Intel™ Specification and any hardware that has license from Intel should work equally well.  This host is running MacOS Big Sur / Monterey.</p>
<p>Here we can see the new network service(s) that came up after connecting the Thunderbolt cable between the machines - <code>Thunderbolt Ethernet Slot 1</code> and <code>Thunderbolt Bridge</code>:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mini-01:~ cbergeron$ networksetup -listallnetworkservices</span><br><span class="line"></span><br><span class="line">An asterisk (*) denotes that a network service is disabled.</span><br><span class="line">Ethernet</span><br><span class="line">Ethernet Adaptor (en4)</span><br><span class="line">Ethernet Adaptor (en5)</span><br><span class="line">USB 10/100/1000 LAN</span><br><span class="line">Wi-Fi</span><br><span class="line">Bluetooth PAN</span><br><span class="line">Thunderbolt Ethernet Slot 1</span><br><span class="line">iPhone USB</span><br><span class="line">Thunderbolt Bridge</span><br></pre></td></tr></tbody></table></figure>
<p>Much the way we set an IP on the Linux host, we will do the same thing on the Mac.  You can set the IP of the TB interface however you want.  Either via the command line with posix tools:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mini-01:~ cbergeron$ ifconfig thunderbolt0 10.10.10.2</span><br><span class="line"></span><br><span class="line">mini-01:~ cbergeron$ ifconfig bridge0</span><br><span class="line">bridge0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500</span><br><span class="line">	options=63&lt;RXCSUM,TXCSUM,TSO4,TSO6&gt;</span><br><span class="line">	ether 36:80:87:2a:ec:40</span><br><span class="line">	inet6 fe80::1868:9be:b378:7ef3%bridge0 prefixlen 64 secured scopeid 0xf</span><br><span class="line">	inet 10.10.10.2 netmask 0xffffff00 broadcast 10.10.10.255</span><br><span class="line">	Configuration:</span><br><span class="line">		id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0</span><br><span class="line">		maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200</span><br><span class="line">		root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0</span><br><span class="line">		ipfilter disabled flags 0x0</span><br><span class="line">	member: en2 flags=3&lt;LEARNING,DISCOVER&gt;</span><br><span class="line">	        ifmaxaddr 0 port 9 priority 0 path cost 0</span><br><span class="line">	member: en3 flags=3&lt;LEARNING,DISCOVER&gt;</span><br><span class="line">	        ifmaxaddr 0 port 10 priority 0 path cost 0</span><br><span class="line">	Address cache:</span><br><span class="line">		12:e2:e9:5f:d5:4b Vlan1 en3 0 flags=0&lt;&gt;</span><br><span class="line">		36:50:51:3f:7c:0 Vlan1 en2 0 flags=0&lt;&gt;</span><br><span class="line">		2:e2:e9:5f:d5:4b Vlan1 en2 0 flags=0&lt;&gt;</span><br><span class="line">	nd6 options=201&lt;PERFORMNUD,DAD&gt;</span><br><span class="line">	media: autoselect</span><br><span class="line">	status: active</span><br></pre></td></tr></tbody></table></figure>
<p>or macos commands:<br></p><figure class="highlight zsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mini-01:~ cbergeron$ networksetup -getinfo <span class="string">"Thunderbolt Bridge"</span></span><br><span class="line">Manual Configuration</span><br><span class="line">IP address: 10.10.10.2</span><br><span class="line">Subnet mask: 255.255.255.0</span><br><span class="line">Router: 10.10.10.2</span><br><span class="line">IPv6: Automatic</span><br><span class="line">IPv6 IP address: none</span><br><span class="line">IPv6 Router: none</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Or, using the UI:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/macos-thunderbolt-network-settings-some-links-active-bridge.png" alt="Image of Network Preference Pane" title="Macos Big Sur Network Settings Preference Pane, Thunderbolt Bridge"></p>
<!-- NOTE: If you want your routes to persist across reboots, you can use the `networksetup -setadditionalroutes` command [details at this link](http://networknucleus.com/2018/06/07/persistent-static-routes-in-macos/). -->
<h1 id="Benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks</h1><p>This is probably the part of this post that you came here for.</p>
<p>To benchmark the connection speed I used <code>iperf3</code> so that disk I/O isn’t a variable.  Even though I’m using tiered storage including NVMe’s on the NAS server, at this point I’m just interested in the connection capability.  Here are the results from <code>iperf3 -s</code> on the Mac mini:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------------</span><br><span class="line">Server listening on 5201 (<span class="built_in">test</span> <span class="comment">#2)</span></span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">Accepted connection from 192.168.10.2, port 43732</span><br><span class="line">[  5] <span class="built_in">local</span> 192.168.10.4 port 5201 connected to 192.168.10.2 port 43734</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.95 GBytes  16.7 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  2.01 GBytes  17.3 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  2.01 GBytes  17.2 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  2.00 GBytes  17.2 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  2.01 GBytes  17.3 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  2.01 GBytes  17.3 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  2.01 GBytes  17.3 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  1.98 GBytes  17.0 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  1.98 GBytes  17.0 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  1.98 GBytes  17.0 Gbits/sec</span><br><span class="line">[  5]  10.00-10.00  sec  2.18 MBytes  16.5 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-10.00  sec  19.9 GBytes  17.1 Gbits/sec                  receiver</span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">Server listening on 5201 (<span class="built_in">test</span> <span class="comment">#3)</span></span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">^Ciperf3: interrupt - the server has terminated</span><br></pre></td></tr></tbody></table></figure>
<p>Not bad.  Not quite what I was expecting though.  I initially thought I would see closer to 35Gbps (40Gbps minus 10-15% overhead).  This is more inline with 85% of 20 Gbps.</p>
<p>I know that Thunderbolt 3 and 4 are rated at 40Gbps:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/thunderbolt-phy-20gbps-logical-physical-link.jpg" alt="40 Gbps per Intel" title="Image of Thunderbolt 4 logical and physical bandwidth"></p>
<p>Interesting.  It’s almost exactly half of what I expected.  Could it be that it’s operating at half duplex?</p>
<p>Let’s check the PHY link speed (NAS):<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /sys/bus/thunderbolt/devices/0-1/tx_speed /sys/bus/thunderbolt/devices/0-1/rx_speed</span><br><span class="line">20.0 Gb/s</span><br><span class="line">20.0 Gb/s</span><br></pre></td></tr></tbody></table></figure><br>Aha.  It’s 20Gb/s per direction.  20 transmit (tx), 20 receive (rx).  Huh, TIL.<p></p>
<p>And the Mac:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/Thunderbolt-device-tree-connected.jpg" alt="System Report Link Speed - 20 Gb/s" title="Macos System Report Link Speed showing twenty gigabits per second"></p>
<p>To dig deeper I decided to try transmitting and receiving simultaneously.  In theory, I should get ~17Gbps from each server as both a sender and receiver for a link saturation around 34 Gbps.  Let’s see what happens:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/perplexing-speed-text-mixed-results-iperf3-thunderbolt-cb.png" alt="Not what I expected, redux.  Left side is Mac, Right side is NAS." title="Screenshot of perplexing speeds - mixed fast and slow"></p>
<p>Well damn.  I’m not quite sure what to make of this.  <em>(Please comment below if you have any insights)</em></p>
<p>To further reduce the equation I tried to test speeds between two Macs over Thunderbolt (both M1 processors, both Thunderbolt 3) to see if there’s an issue with the PCIe Ridge Titan card or the cable.  One is a 2020 Macbook Air, the other is the 2020 Mac Mini.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ sudo iperf3 -s</span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">Server listening on 5201 (<span class="built_in">test</span> <span class="comment">#1)</span></span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">Accepted connection from 10.10.10.2, port 60489</span><br><span class="line">[  5] <span class="built_in">local</span> 10.10.10.7 port 5201 connected to 10.10.10.2 port 60490</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  2.27 GBytes  19.5 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  2.43 GBytes  20.8 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  2.37 GBytes  20.4 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  2.36 GBytes  20.2 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  2.33 GBytes  20.1 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  2.33 GBytes  20.0 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  2.34 GBytes  20.1 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  2.35 GBytes  20.2 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  2.33 GBytes  20.0 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  2.34 GBytes  20.1 Gbits/sec</span><br><span class="line">[  5]  10.00-10.00  sec   576 KBytes  19.6 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-10.00  sec  23.4 GBytes  20.1 Gbits/sec                  receiver</span><br></pre></td></tr></tbody></table></figure>
<p>Better, but not by much.  It’s 20Gbps, not 34Gbps.  Thunderbolt is 40Gbps but I’m only seeing half that.  I know I don’t have a PCIe bottleneck because Thunderbolt uses 4 lanes of PCIe 3.0, which it has (dedicated).</p>
<p>When I look at the link speed, I can see that the link between the two Mac’s over Thunderbolt is 40Gbps:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/mac-to-mac-40gbps-link-over-thunderbolt-cb.png" alt="40 Gbps link between two Macs" title="Screenshot of 40 Gbps link between two Mac computers"></p>
<p>So, that’s as far as I’ve gotten thus far.</p>
<p>In summary:</p>
<ul>
<li>Mac to Mac: 40 Gb/s x1, link width 0x2</li>
<li>Mac to Linux: 20 Gb/s x2, link width 0x1</li>
</ul>
<p>It just occurred to me that Thunderbolt 4 is guaranteed 40 Gbps.  Thunderbolt 3 is not.  Remember how I mentioned STANDARDIZATION at the beginning of this post as the only major difference between TB4 and TB3?  Perhaps total throughput is as well.</p>
<h1 id="Thunderbolt-Header"><a href="#Thunderbolt-Header" class="headerlink" title="Thunderbolt Header"></a>Thunderbolt Header</h1><p>This information is not authoritative but I’m providing it here for reference.  This table illustrates what I believe the pinouts are:</p>
<table>
<thead>
<tr>
<th>Pin</th>
<th>Name</th>
<th>TBT Controller</th>
<th>Motherboard</th>
<th>Alpine Ridge Controller</th>
<th>Misc Other</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>Force Power</td>
<td>POC_GPIO_3</td>
<td>TBT_FORCE_PWR</td>
<td>IN,FORCE FULL POWER ON</td>
<td>Power</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>Plug Event</td>
<td>GPIO_5</td>
<td>TBT_CIO_PLUG_EVENT#</td>
<td>OUT, HOT PLUG INDICATION</td>
<td>Plug Event</td>
<td>Connect to PCH (Make sure PCH supports SCI);  might goes high when USB-C device is plugged in</td>
</tr>
<tr>
<td>3</td>
<td>S3 Sleep Indication</td>
<td>POC_GPIO_5</td>
<td>TBT_SLP_S3#</td>
<td>IN,SLP S3 INDICATION</td>
<td>Platform Sequence Control</td>
<td>S3 is ACPI Suspend, likely used in this context here</td>
</tr>
<tr>
<td>2</td>
<td>S4_S5</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>Platform Sequence Control</td>
<td>Potentially wired to RESET_N on Thunderbolt Controller</td>
</tr>
<tr>
<td>1</td>
<td>Ground</td>
<td>GND</td>
<td>GND</td>
<td></td>
<td>Ground</td>
</tr>
</tbody>
</table>
<p><a target="_blank" rel="noopener" href="https://superuser.com/questions/1661314/linux-will-not-recognize-thunderbolt-3-titan-ridge-card-on-supermicro-motherbo">This is an informative post on superuser.com</a> </p>
<p>The consensus appears to be that 5 is power, 1 is ground and <strong>these two should never be shorted together</strong>.  Based on the schematic of the Alpine Ridge card, a few things are confirmed:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/ar-tbt-gpio-and-poc-gpio.jpg" alt="Alpine Ridge Schematic snippet" title="A small portion of the Alpine Ridge Schematic"></p>
<ul>
<li>The POC_GPIO pins are all inputs.</li>
<li>GPIO_3 is tied to ground through a 100k resistor</li>
<li>GPIO_5 is TB_PLUG_EVENT#</li>
</ul>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/ar-tbt-plug-event-force-pwr.jpg" alt="Alpine Ridge Plug Event Force Power"></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/ar-tbt-plug-event-pull.jpg" alt="PLUG_EVENT tied to GND and V3A_TBT?" title="PLUG EVENT Tied to ground and V3A_TBT"></p>
<h1 id="Next-Steps"><a href="#Next-Steps" class="headerlink" title="Next Steps"></a>Next Steps</h1><ul>
<li><p>I’ve ordered another Thunderbolt 4 Cable so I can create a dual link Thunderbolt Bridge between the Mac and the NAS.  Unfortunately, they’re not cheap and they’re not even fiber yet.  However, even if I don’t use them in a permanent capacity here, I’ll have an extra on hand for USB4 or another USB-C use.</p>
</li>
<li><p>To troubleshoot the uneven simultaneous TX / RX speeds between the Mac and the Linux server, I’ll try to test between the two Macs to see if I get more consistent bilateral speeds there.  I’m also going to check the CPU and Memory pressure just to see how they’re affected by transferrring 500GB.  I’ll update this post with my findings.</p>
</li>
<li><p>I’m going to look over the Linux kernel driver code to see if there’s anything there that could be throttling.  Thunderbolt was supposed to have a 10Gbps bandwidth throttle to allow for DisplayPort and USB, but it appears to have been unofficially lifted (or Apple is doing something proprietary between hosts).</p>
</li>
</ul>
<!--
# Takeaway
As I mentioned, this type of setup isn't novel - it's just not well documented online (at least based on my Duck Duck Go search skills).
-->
<h1 id="Notes-Errata-Miscellany-et-al-TBD-ad-nausem-La-donna-e-mobile-etc"><a href="#Notes-Errata-Miscellany-et-al-TBD-ad-nausem-La-donna-e-mobile-etc" class="headerlink" title="Notes, Errata, Miscellany, et al., TBD., ad nausem, La donna è mobile, etc."></a>Notes, Errata, Miscellany, et al., TBD., ad nausem, La donna è mobile, etc.</h1><h3 id="Cables"><a href="#Cables" class="headerlink" title="Cables"></a>Cables</h3><p>It’s important to use Thunderbolt 3/4 cables and not just any USB-C cable because there are many types of USB-C cables.  USB-C is the form factor of the connector.  That’s it.  The connector.  It’s not even wire compatible.  Some cables only connect power wires (charging cables).</p>
<p>Thunderbolt 4 is a regorous specification by design.  The primary benefit of Thunderbolt 4 over Thunderbolt 3 is not performance - it’s <strong>STANDARDIZATION</strong>.  If you buy a Thunderbolt 4 device, it can only receive the offical Intel™ Thunderbolt™ 4™ Certification™<em> if it complies with </em>all* of the protocol specs.  I kid about the numerous Trademark symbols (™), but Intel and Apple have done everyone a favor here.  Thunderbolt 4 is designed to reduce the confusion that USB 3 and USB4 have.</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/pcmag-usb-table.jpg" alt="USB Table Image - PCMag" title="Table showing many different USB 3 specifications"></p>
<p>Currently, in the USB-C form factor there are USB-C Charging cables, data transfer cables, multi-purpose cables, low-speed cables and 10Gbps and 20Gbps cables.  If you’ve ever shopped for a USB-C <strong>anything</strong> on popular sites like smile.amazon.com, you’ll see marketing bar graphs that show how fast USB-C is.  Well, USB 3.0 is.  Well, USB 3 Gen 1, not USB 3.0.  Actually - even faster is USB 3 Gen 2 (USB-C).  If the cable isn’t used in a USB hub.  Or if it is, it has to be connected to a Powered USB 3.x Dock.</p>
<p>Confusing isn’t it?</p>
<p>Thunderbolt 4 will hopefully do away with all of that <em>(but with a higher price tag)</em>.</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/usb-encompased-by-thunderbolt-4-500-cb.png" alt="Thunderbolt 4 > USB"></p>
<p>USB 3.whatever and USB4 <em>protocols</em> can run over Thunderbolt, but not the other way around.</p>
<h3 id="Other-Notes"><a href="#Other-Notes" class="headerlink" title="Other Notes"></a>Other Notes</h3><p>You may lose functionality if your motherboard doesn’t have a Thunderbolt header and you use the workaround I indicated above (shorting pins 3 and 5).  Specifically, the ability to cycle the cards power from Linux since we’re forcing the board ‘on’.</p>
<!--## Troubleshooting

Can't ping:
  - check firewall rules on both hosts
  - check SE linux policies (on linux hosts)
  - check output of tcpdump -i thunderbolt0 on both ends

USB4 specification is great for transferring small files, which was one of the intended purposes of USB - (cameras, SD cards, etc).  For larger payloads, Thunderbolt has lower overhead and better handling of large block streams (MTU 9000) [VALIDATE AND SUPPORT THIS]
-->
<h1 id="Credit-s"><a href="#Credit-s" class="headerlink" title="Credit(s)"></a>Credit(s)</h1><p>Much thanks goes to Mika Westerberg @ Intel for the linux kernel work along with everyone at LKML that worked on it. Also, karatekid430 for his excellent resources on Thunderbolt in the kernel guide 2019-11-12.pdf<br><a target="_blank" rel="noopener" href="https://christian.kellner.me/">Christian Kellner</a> - <a target="_blank" rel="noopener" href="https://lore.kernel.org/linux-acpi/20210126155723.9388-4-mika.westerberg@linux.intel.com/T/">for his excellent work</a> on the Thunderbolt Linux userspace utils and <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_oLSrNYDAlY">presentations</a>.  Please visit his blog and <a target="_blank" rel="noopener" href="https://twitter.com/gicmo/">like or follow him</a> if you’re interested in more about Thunderbolt on Linux.<br><a target="_blank" rel="noopener" href="https://christian.kellner.me/2018/04/23/the-state-of-thunderbolt-3-in-fedora-28/">https://christian.kellner.me/2018/04/23/the-state-of-thunderbolt-3-in-fedora-28/</a></p>
<p>And of course Apple™ and Intel™ for joining resources for this specification - even if only for a brief period of time.</p>
<h1 id="Further-Reading-Resources"><a href="#Further-Reading-Resources" class="headerlink" title="Further Reading / Resources"></a>Further Reading / Resources</h1><p><a target="_blank" rel="noopener" href="https://larryjordan.com/articles/what-is-thunderbolt-4-and-should-we-care/">Larry Jordan’s excellent Thunderbolt Introduction</a><br><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Thunderbolt">Thunderbolt 3 - Arch Wiki</a><br><a target="_blank" rel="noopener" href="https://www.pcmag.com/how-to/what-is-thunderbolt-4-why-this-new-interface-will-matter-in-pcs-in-2021">What Is Thunderbolt 4? Why This New Interface Will Matter in PCs in 2021</a><br><a target="_blank" rel="noopener" href="https://satechi.net/blogs/news/thunderbolt-3-vs-usb-c-whats-the-difference-1">Thunderbolt 3 Vs. USB-C: What’s The Difference?</a><br><!--CB reference - https://www.sonnettech.com/product/echo11-thunderbolt4-dock/overview.html>https://christian.kellner.me/2018/10/24/thunderbolt-port-guide-t480s-force-power/ Not all USB-C ports are Thunderbolt Ports!https://egpu.io/forums/thunderbolt-enclosures/pdf-guide-and-patches-for-making-linux-v5-3-kernel-to-work-with-thunderbolt-3-add-in-card/ nofollowhttps://www.pcmag.com/how-to/what-is-usb-c-an-explainer nofollow --></p>
<h1 id="Questions-Comments-Suggestions"><a href="#Questions-Comments-Suggestions" class="headerlink" title="Questions / Comments / Suggestions"></a>Questions / Comments / Suggestions</h1><p>If you’ve enjoyed this post, please <a target="_blank" rel="noopener" href="https://twitter.com/bergeron">follow me on twitter</a> and/or leave a comment below.  Is there anything I should try?  Increasing the transmission MTU perhaps?  Or maybe you know why I get strange speeds when I TX and RX simultaneously …<br><!-- Remarkbox - Your readers want to communicate with you --></p>
<div id="remarkbox-div"><br>  <noscript><br>    <iframe id="remarkbox-iframe" src="https://my.remarkbox.com/embed?nojs=true" style="height:600px;width:100%;border:none!important" tabindex="0"></iframe><br>  </noscript><br></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-2336374166717359" data-ad-slot="9989366977"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script src="https://my.remarkbox.com/static/js/iframe-resizer/iframeResizer.min.js"></script>

<script>
  var rb_owner_key = "241e7c0f-a258-11eb-9fe5-040140774501";
  var thread_uri = window.location.href;
  var thread_title = window.document.title;
  var thread_fragment = window.location.hash;
  var rb_src = "https://my.remarkbox.com/embed" + 
      "?rb_owner_key=" + rb_owner_key +
      "&thread_title=" + encodeURI(thread_title) +
      "&thread_uri=" + encodeURIComponent(thread_uri) + 
      thread_fragment;

  function create_remarkbox_iframe() {
    var ifrm = document.createElement("iframe");
    ifrm.setAttribute("id", "remarkbox-iframe");
    ifrm.setAttribute("scrolling", "no");
    ifrm.setAttribute("src", rb_src);
    ifrm.setAttribute("frameborder", "0");
    ifrm.setAttribute("tabindex", "0");
    ifrm.setAttribute("title", "Remarkbox");
    ifrm.style.width = "100%";
    document.getElementById("remarkbox-div").appendChild(ifrm);
  }

  create_remarkbox_iframe();

  iFrameResize(
    {
      checkOrigin: ["https://my.remarkbox.com"],
      inPageLinks: true,
      initCallback: function(e) {e.iFrameResizer.moveToAnchor(thread_fragment)}
    },
    document.getElementById("remarkbox-iframe")
  );
</script>
</div><div class="article-licensing box"><div class="licensing-title"><p>Ultra fast Thunderbolt NAS with Apple M1 and Linux</p><p><a href="https://chrisbergeron.com/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/">https://chrisbergeron.com/2021/07/25/Ultra-fast-Thunderbolt-NAS-with-Apple-M1-and-Linux/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Chris Bergeron</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>07-25-2021</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>03-31-2023</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a><a class="link-muted mr-2" rel="tag" href="/tags/das/">das</a><a class="link-muted mr-2" rel="tag" href="/tags/thunderbolt/">thunderbolt</a><a class="link-muted mr-2" rel="tag" href="/tags/nvme/">nvme</a><a class="link-muted mr-2" rel="tag" href="/tags/big-sur/">big sur</a><a class="link-muted mr-2" rel="tag" href="/tags/apple/">apple</a><a class="link-muted mr-2" rel="tag" href="/tags/tbt3/">tbt3</a><a class="link-muted mr-2" rel="tag" href="/tags/tbt4/">tbt4</a><a class="link-muted mr-2" rel="tag" href="/tags/nas/">nas</a><a class="link-muted mr-2" rel="tag" href="/tags/monterey/">monterey</a><a class="link-muted mr-2" rel="tag" href="/tags/titan-ridge/">titan ridge</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support me with</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/cbergeron" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="cbergeron@gmail.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/08/11/Fast-RAID-0-DAS-Using-Multiple-Thunderbolt-4-Busses/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Fast RAID-0 DAS Using Two Thunderbolt 3 Enclosures</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/07/04/Person-is-not-a-known-valid-target-type-for-the-publisher-property/"><span class="level-item">Person is not a known valid target type for the publisher property.</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><script src="https://utteranc.es/client.js" repo="chrisbergeron/chrisbergeron" issue-term="title" theme="preferred-color-scheme" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Contents</h3><ul class="menu-list"><li><a class="level is-mobile" href="#My-Motivation-s"><span class="level-left"><span class="level-item">1</span><span class="level-item">My Motivation(s)</span></span></a></li><li><a class="level is-mobile" href="#Adding-a-Thunderbolt-3-PCIe-Add-on-Card"><span class="level-left"><span class="level-item">2</span><span class="level-item">Adding a Thunderbolt 3 PCIe Add-on Card</span></span></a></li><li><a class="level is-mobile" href="#Configuration"><span class="level-left"><span class="level-item">3</span><span class="level-item">Configuration</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Host-1-NAS-04-Linux"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Host 1:  NAS-04 (Linux)</span></span></a></li><li><a class="level is-mobile" href="#Host-2-Apple-Mac-Mini"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Host 2: Apple Mac Mini</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Benchmarks"><span class="level-left"><span class="level-item">4</span><span class="level-item">Benchmarks</span></span></a></li><li><a class="level is-mobile" href="#Thunderbolt-Header"><span class="level-left"><span class="level-item">5</span><span class="level-item">Thunderbolt Header</span></span></a></li><li><a class="level is-mobile" href="#Next-Steps"><span class="level-left"><span class="level-item">6</span><span class="level-item">Next Steps</span></span></a></li><li><a class="level is-mobile" href="#Notes-Errata-Miscellany-et-al-TBD-ad-nausem-La-donna-e-mobile-etc"><span class="level-left"><span class="level-item">7</span><span class="level-item">Notes, Errata, Miscellany, et al., TBD., ad nausem, La donna è mobile, etc.</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Cables"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">Cables</span></span></a></li><li><a class="level is-mobile" href="#Other-Notes"><span class="level-left"><span class="level-item">7.1.2</span><span class="level-item">Other Notes</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#Credit-s"><span class="level-left"><span class="level-item">8</span><span class="level-item">Credit(s)</span></span></a></li><li><a class="level is-mobile" href="#Further-Reading-Resources"><span class="level-left"><span class="level-item">9</span><span class="level-item">Further Reading / Resources</span></span></a></li><li><a class="level is-mobile" href="#Questions-Comments-Suggestions"><span class="level-left"><span class="level-item">10</span><span class="level-item">Questions / Comments / Suggestions</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for more great content</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=ChrisBergeron&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="ChrisBergeron" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div><p class="help">Chris Bergerons Tech Blog</p></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://holdingco.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">The Holding Company</span></span><span class="level-right"><span class="level-item tag">holdingco.com</span></span></a></li><li><a class="level is-mobile" href="https://debris-art.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Debris Art</span></span><span class="level-right"><span class="level-item tag">debris-art.com</span></span></a></li><li><a class="level is-mobile" href="https://metacrypt.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MΞTΛcrypt</span></span><span class="level-right"><span class="level-item tag">metacrypt.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-01T02:57:08.504Z">03-31-2023</time></p><p class="title"><a href="/2023/03/31/renewing-an-80s-server-cabinet/"> </a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/05/29/Own-Yourself-You-Are-Your-Brand/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/images/cb-64x64.png" alt="Own Yourself - You Are Your Brand"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-05-29T17:28:27.000Z">05-29-2022</time></p><p class="title"><a href="/2022/05/29/Own-Yourself-You-Are-Your-Brand/">Own Yourself - You Are Your Brand</a></p><p class="categories"><a href="/categories/Professional/">Professional</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/01/08/Monitoring-Uptime-Status-with-Github-Actions/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/images/github-logo-sm.png" alt="Monitoring Uptime Status with Github Actions"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-01-08T21:40:44.000Z">01-08-2022</time></p><p class="title"><a href="/2022/01/08/Monitoring-Uptime-Status-with-Github-Actions/">Monitoring Uptime Status with Github Actions</a></p><p class="categories"><a href="/categories/Software/">Software</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/01/08/Time-Tracking-with-a-Disney-Infinity-USB-NFC-Reader/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/images/disney-infinity-cb.png" alt="Time Tracking with a Disney Infinity USB NFC Reader"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-01-08T15:20:07.000Z">01-08-2022</time></p><p class="title"><a href="/2022/01/08/Time-Tracking-with-a-Disney-Infinity-USB-NFC-Reader/">Time Tracking with a Disney Infinity USB NFC Reader</a></p><p class="categories"><a href="/categories/Homelab/">Homelab</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/01/08/Controlling-iRobot-Roomba-from-the-command-line/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/images/irobot.png" alt="Controlling iRobot Roomba from the Command Line"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-01-08T14:40:20.000Z">01-08-2022</time></p><p class="title"><a href="/2022/01/08/Controlling-iRobot-Roomba-from-the-command-line/">Controlling iRobot Roomba from the Command Line</a></p><p class="categories"><a href="/categories/Home/">Home</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Crypto/"><span class="level-start"><span class="level-item">Crypto</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Devops/"><span class="level-start"><span class="level-item">Devops</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Home/"><span class="level-start"><span class="level-item">Home</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Homelab/"><span class="level-start"><span class="level-item">Homelab</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Politics/"><span class="level-start"><span class="level-item">Politics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Professional/"><span class="level-start"><span class="level-item">Professional</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Telematics/"><span class="level-start"><span class="level-item">Telematics</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsBAMAAACLU5NGAAAAHlBMVEVHcExZWVnU1NSbm5toaGiAgIC1tbXv7+8/Pz8ZGRkzrvrZAAAAAXRSTlMAQObYZgAAAxRJREFUeNrt2M1T00AYx/HQt1x56Iscg4UZj40tVG+GFvFIhaLHVqb1WgbwXgfHcvfQ/LfublJwU3CGKWaifj8zfckzmdlfN/uS1HEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+jLclkq/qE7f1MxgoqxPrrL2JGhzyxllr9ciLHnvnSkoOB/uLuSsfTJ5hXzTkLTiem3pLjyXAjlVilQETKqtmS+pSqbt/XlbtYV+rQjH1d308p1lA645580LFOx74cOU5eKntnEtzG6nVGUpmY+rhV8VOJlZOaegvK6hJ91l82dNC2WhtkEUt35VAG+tvAcX1JJVZBGubIi/tO5dMZVcDbWKYD1VugfoBTTCfWUF8e1VgjLlfVxTyMBtIilqf7dD2u59KJ5ZfNuJc30eGaqJ5pLE5YvBxHhYnr6cTq1czUl2d6hdhVs1L13ODeWHE9nVhxK/qjrlcIUR3m3Rsrrqcdq6TWhedbGYkVbCwuop7/emwVHohVSDPW3ZD3a9GQLz4w5KO6m/YCYfrtXBaz0k/GiuopLRCXpg+GMomuzlBUf9RM88lYUT2l5bQk5fjNr5rtWvfTwNp8FiPKT2Xz6Wueakxv1Q1deTsODlSIKzUlRzJainWlt+ryn45leNGNTc2JbmyqOyqE29OV4lIsU2+nFMu56El0l1cPOoOS2QH17d5yLFWvvHTMfpA5rtq0M6ikb3Gy5zLasLPUUWoEur5ZfrPkvLqnbvb3s3b9zOStepmbhKMgfqIEAAAAAPwLXof2X1P52bX91OfP3ttP992OfcJOv20d55p7Kz/658NwbhVe3czWrRTT6bV1wna3e2Sl6PePrRPqzWZj1ViFMAytH/9xfvP11+PidDq1Tmh1u9Y/Dvl+v2/1zlmz2V411loy1rvZ/PGxvKeOVbynt77bY21zc5KIdWhd5WRv1Z8gVi4Mf1iFF7O5PXSm02/JsdX47di6aDYHK8/EbbHHZ+6k4yQmWiM50ZzEELdnpjv+xAIHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI/2Ez8QiNuDAFljAAAAAElFTkSuQmCC" data-original="/images/logo.png" alt="Chris Bergerons Tech Blog" height="28" width="288"></a><p class="is-size-7"><span>&copy; 2023 Chris Bergeron</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="RSS" href="https://chrisbergeron.com/atom.xml"><i class="fa fa-rss fa-1x"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/chrisbergeron/"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Medium" href="https://c-bergeron.medium.com/"><i class="fab fa-medium"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/bergeron"><i class="fab fa-tiwtter"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script>!function(r){var o=Array.prototype.slice.call(document.querySelectorAll("[data-original]"));function t(){for(var t=0;t<o.length;t++)!function(t){var e,i,n,l;i=o[t],n=i.getBoundingClientRect(),l=r.innerWidth||document.documentElement.clientWidth,i=r.innerHeight||document.documentElement.clientHeight,(100<=n.top||100<=n.left||n.top<0&&100<=n.top+n.height||n.left<0&&100<=n.left+n.width)&&n.top<=i&&n.left<=l&&(e=o[t],i=function(){o.splice(t,1)},n=e.getAttribute("data-original"),"yes"!==e.getAttribute("data-init")&&(l=e.getAttribute("data-isbg"),n=n.replace(/^https?:/,""),l?e.style.backgroundImage=n:e.setAttribute("src",n),e.setAttribute("data-init","yes"),i&&i()))}(t)}t(),r.addEventListener("scroll",t)}(this);</script></body></html>